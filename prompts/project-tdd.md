# Project Tdd

**指令**: `/project-tdd [--fix|--enhance] [description]`
**版本**: v1.2.0
**功能**: 快速 TDD 流程，適用於 bug 修復和小功能增強
**可用工具**: Bash, Read, Write, Edit, MultiEdit, TodoWrite, Glob, Grep - 建議限制使用這些工具

---
# 快速 TDD 流程

處理 bug 修復和小功能增強的 TDD 流程，不需要完整 user story。

## 🚨 注意

**⚠️ 重要 ⚠️ 重要 ⚠️ 重要**

1. KISS 不要過度設計
2. 務必深思熟慮 (ultrathink)
3. 先做計劃,在我同意前不要進行任何操作,如果有不明白的地方要跟我討論, 在計劃完成後,會停止下來要求確認,並且提示已經遵守了上述規範

## 核心邏輯

### 使用方式

```bash
/project:tdd                     # 根據描述自動判斷類型
/project:tdd --fix              # 明確指定為 bug 修復
/project:tdd --enhance          # 明確指定為功能增強
```

### 執行流程

#### 階段 0：參數處理與類型確認

1. **解析參數**
   - [ ] 解析 `$ARGUMENT` 內容
   - [ ] 分離 flag（--fix/--enhance）和 description

2. **確認任務類型**
   - [ ] 如果有 flag（--fix 或 --enhance）：使用指定類型
   - [ ] 如果沒有 flag：**詢問使用者是 bug 修復還是功能增強**
   - [ ] 等待使用者選擇類型後繼續

#### 階段 1：需求收集與理解

1. **收集需求描述**
   - [ ] 如果有提供 description：直接使用
   - [ ] 如果沒有 description：**根據類型進行互動式討論**
     - [ ] Bug 修復：詢問「請描述遇到的問題」、「什麼情況下會發生」、「預期行為是什麼」
     - [ ] 功能增強：詢問「想要增加什麼功能」、「解決什麼問題」、「預期效果」
   - [ ] 透過多輪對話收集完整需求

2. **理解問題**
   - [ ] 整理使用者提供的資訊
   - [ ] 確認理解正確
   - [ ] 理解預期行為

3. **分析影響範圍**
   - [ ] 找出需要修改的檔案
   - [ ] 確認相關的測試檔案
   - [ ] 評估影響的功能模組

4. **制定計劃**
   - [ ] **任務清單**：

   - [ ] 列出 TDD 步驟
   - [ ] **停止並要求確認** ⚠️

#### 階段 2：TDD 循環執行

執行完整的 TDD cycle，但跳過 user story：

1. **TDD-Red（紅燈）**
   - [ ] 先寫測試，重現 bug 或定義新功能
   - [ ] 確保測試失敗
   - [ ] 遵循 `project:tdd-red` 規則

2. **TDD-Green（綠燈）**
   - [ ] 實作最小可行代碼
   - [ ] 讓測試通過
   - [ ] 遵循 `project:tdd-green` 規則

3. **TDD-Refactor（重構）**
   - [ ] 優化代碼結構
   - [ ] 保持測試通過
   - [ ] 遵循 `project:tdd-refactor` 規則

### 參數說明

- [ ] `--fix`: Bug 修復模式
  - [ ] 明確指定為 bug 修復
  - [ ] 如果沒有描述，會詢問具體問題
  - [ ] 先寫測試重現 bug
  - [ ] 修復代碼
  - [ ] 確保不破壞其他功能

- [ ] `--enhance`: 功能增強模式
  - [ ] 明確指定為功能增強
  - [ ] 如果沒有描述，會詢問功能需求
  - [ ] 先寫測試定義新行為
  - [ ] 實作功能
  - [ ] 整合到現有系統

- [ ] 無 flag: 互動式確認
  - [ ] **先詢問是 bug 修復還是功能增強**
  - [ ] 根據使用者選擇進入對應模式
  - [ ] 如果沒有描述，透過對話收集需求
  - [ ] 確保理解完整需求後才開始

### 範例

```bash
# Bug 修復（有描述）
/project:tdd --fix "登入功能在輸入特殊字元時會崩潰"

# Bug 修復（無描述，互動式）
/project:tdd --fix
> 系統：「請描述您遇到的問題」
> 使用者：「登入時輸入特殊字元會崩潰」
> 系統：「什麼情況下會發生？」
> 使用者：「當密碼包含 & 或 # 時」

# 功能增強（有描述）
/project:tdd --enhance "需要在使用者列表加入搜尋功能"

# 功能增強（無描述，互動式）
/project:tdd --enhance
> 系統：「您想要增加什麼功能？」
> 使用者：「使用者列表搜尋」
> 系統：「需要搜尋哪些欄位？」
> 使用者：「姓名和電子郵件」

# 無 flag（需先確認類型）
/project:tdd
> 系統：「這是 bug 修復還是功能增強？」
> 使用者：「bug 修復」
> 系統：「請描述您遇到的問題」
> 使用者：「分頁元件在資料為空時顯示錯誤」
```

## 規則配置

### TDD-Red 規則

- [ ] 測試必須先失敗
- [ ] 測試案例要明確描述問題或需求
- [ ] 使用 AAA 模式（Arrange-Act-Assert）
- [ ] 測試名稱要描述預期行為

### TDD-Green 規則

- [ ] 只寫足夠讓測試通過的代碼
- [ ] 不做過早優化
- [ ] 保持簡單直接（KISS）
- [ ] 確保所有測試都通過

### TDD-Refactor 規則

- [ ] 只在測試通過後重構
- [ ] 小步重構，每次運行測試
- [ ] 消除重複代碼
- [ ] 改善可讀性和結構

## 與 project 指令的差異

| 項目       | project 指令 | project:tdd 指令   |
| ---------- | ------------ | ------------------ |
| User Story | 必須         | 不需要             |
| 需求分析   | 完整分析     | 快速理解           |
| 適用場景   | 新功能開發   | Bug 修復、小功能   |
| 執行時間   | 較長         | 較短               |
| TDD 流程   | 完整         | 完整（但簡化前置） |

## 錯誤處理

- [ ] **沒有提供 flag 時，先詢問任務類型**
- [ ] **沒有提供描述時，根據類型互動式收集需求**
- [ ] 無法理解需求時，要求更多資訊
- [ ] 找不到相關檔案時，詢問檔案位置
- [ ] 測試框架不明時，詢問使用的測試工具

## 版本歷史

- [ ] v1.2.0 (2025-09-10) 改進互動流程：先確認類型，再透過對話收集描述
- [ ] v1.1.0 (2025-09-10) 加入參數驗證，確保有描述才執行，無描述時主動詢問
- [ ] v1.0.0 (2025-01-30) 初始版本，整合 fix 和 enhance 功能

