---
description: 建立新筆記或更新現有筆記，智能處理分類、標籤和連結
argument-hint: 筆記名稱 [MOC或更新內容(可選)]
allowed-tools: ["Read", "Write", "Edit", "Grep", "WebFetch"]
version: v1.0.0
---

# Create or Update Note

## 🎯 用途

智能建立或更新筆記，自動處理：

**建立模式**（筆記不存在時）：

- 統一存放在 `Inbox/` 資料夾（待後續整理）
- 自動生成標準 frontmatter
- 設定正確的 `up` 屬性連結到父 MOC
- 自動建立相關的 wiki links
- 互動式填寫筆記摘要（可選）

**更新模式**（筆記存在時）：

- 保留原有 frontmatter 結構
- 自動更新 `updated` 時間戳
- 支援多種內容更新方式（追加、插入、替換）
- 儘可能使用 wiki link.
- 保護重要區域不被覆蓋

## 📝 使用方法

`/update-note $ARGUMENTS`

參數格式：

**建立筆記**：

- **單一參數**: `"筆記名稱"` - 建立筆記到 Inbox/
- **雙參數**: `"筆記名稱" "父MOC"` - 指定父 MOC

**更新筆記**：

- `"筆記名稱"` - 互動式選擇更新方式

## 🚨 注意

1. KISS 不要過度設計
2. 先做計劃,在我同意前不要進行任何操作,如果有不明白的地方要跟我討論
3. 務必深思熟慮 (ultrathink)

## 🔧 執行步驟

### 1. **分析階段**

- 解析輸入參數：$ARGUMENTS
- 提取筆記名稱和操作參數
- **智能檢測筆記是否存在**：
  - 優先檢查 `Inbox/` 資料夾
  - 搜尋 `Cards/`、`Sources/`、`Spaces/` 等標準位置
  - 使用 MCP 工具進行全域搜尋
- 根據存在與否決定執行模式（建立/更新）

### 2. **處理階段**

#### A. 建立模式（筆記不存在）

##### 詢問筆記資訊

- 如果未指定父 MOC，基於筆記名稱推薦可能的 MOC
- 詢問使用者確認或選擇父 MOC
- 可選：詢問筆記摘要或描述

##### 建立筆記檔案

```markdown
---
up: "[[父MOC名稱]]"
created: {{date}} {{time}}
updated: {{date}} {{time}}
aliases:
  - {{別名}}
---

# {{筆記名稱}}

{{摘要（如果有提供）}}

## 內容

{{相關連結推薦}}

## 參考資料

-

## 相關筆記

{{自動產生的相關筆記連結}}
```

##### 智能連結生成

- 搜尋現有筆記中的相關內容
- 基於筆記名稱推薦可能的連結
- 自動識別並建立 wiki links

##### 更新父 MOC（如果需要）

- 如果父 MOC 有特定的筆記列表區域
- 在適當位置添加新筆記的連結

#### B. 更新模式（筆記存在）

##### 讀取現有內容

- 解析現有 frontmatter
- 識別章節結構
- 保護重要區域

##### 更新 metadata

- 保留所有原有 frontmatter 欄位
- 只更新 `updated` 時間戳
- 維持格式一致性
- 檢查內容是否需要轉換成 wiki link

### 3. **輸出階段**

**建立模式**：

- 建立檔案於 `Inbox/` 目錄
- 顯示建立成功訊息
- 提供後續操作建議

**更新模式**：

- 提出更新計劃
- 顯示更新摘要（修改了哪些部分）
- 讓使用者確定後再進行更新

## ⚠️ 注意事項

- 筆記名稱支援中英文
- 自動處理特殊字符和空格
- **建立模式**：
  - 新筆記一律存放在 Inbox
  - 自動 MOC 推薦
  - 相關筆記連結生成
  - 不在 frontmatter 中設定 tags 屬性
- **更新模式**：
  - 永不覆蓋 frontmatter（除了 updated 時間）
  - 保護參考資料等重要區域
  - 更新前自動備份（可選）
  - 支援撤銷操作提示

## 📚 相關指令

- `/create-moc` - 建立新的 MOC
- `/note-link` - 管理筆記間的連結
- `/obsidian-search` - 搜尋現有筆記

## 🔄 工作流程整合

1. **建立前**:
   - 使用 `/obsidian-search` 確認筆記不存在
   - 使用 `/obsidian-list` 查看目標資料夾結構

2. **建立後**:
   - 立即開始編輯內容
   - 添加相關標籤
   - 建立與其他筆記的連結

## 版本歷史

- v1.0.0 (2025-08-26) 標準化 YAML front matter，遵循 Claude Code 規範
