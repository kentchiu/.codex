---
version: 1.0.0
description: 智能萃取 vue page 或 ts file 中的繁體中文內容到 @i18n/zh-TW.json，包含計劃階段和現有 key 復用
argument-hint: TARGET=<path>
---
# Rpm I18N Extract

**可用工具**: Read, Edit, MultiEdit, Glob, Grep, TodoWrite - 建議限制使用這些工具

---
# /i18n:extract - 智能繁體中文萃取工具


> ⚠️ **RPM 專案專用**
> 此 command 專為 rpm6/app/doc 專案設計，在其他專案中使用可能無法正常運作。
>
> **依賴項目**:
> - GitLab MCP Server (如適用)
> - 專案結構: `.ai/workbench/`, `.claude/rules/`
> - 專案特定配置和檔案結構
>
> **執行前請檢查**:
> 1. 當前是否在正確的專案目錄中
> 2. 相關依賴是否存在
> 3. 必要的環境變數是否已設定

---


## 🎯 用途

智能萃取 Vue 頁面或 TypeScript 檔案中的繁體中文內容，通過**計劃驅動工作流程**最大化復用現有 common key，並按照專案規範整理到 `@i18n/zh-TW.json`。

## 🚨 注意

這個指令很重要, 指令的結果會很大幅度的影響我工作的效率,所以, 務必遵守以下規範:

1. 先做計劃,在我同意前不要進行任何操作,如果有不明白的地方要跟我討論.
2. 務必啟動 Deep Think

## ✨ 核心特性

### 🧠 智能計劃階段

- [ ] **現有 key 智能匹配**：掃描 zh-TW.json，找出可復用的 key
- [ ] **積極語義匹配**：包含相似語義的匹配 (如「確認」vs「確定」)
- [ ] **內容分類分析**：將待處理文字分為「復用」、「新增」、「需決策」三類
- [ ] **影響統計預估**：計算檔案變更數量、key 使用效率提升

### 🛡️ Common 保護原則

- [ ] **絕不修改 common 內容**：只進行復用，確保系統穩定性
- [ ] **最大化復用**：優先使用現有 common key，減少重複維護

### 🎯 批量決策介面

- [ ] **一次展示**：所有待決策項目統一呈現
- [ ] **分類清晰**：復用/新增/決策分別展示
- [ ] **快速確認**：支持批量決策，提升效率

## 📝 使用方法

`/i18n:extract {{ARGS}}`

- [ ] {{ARGS}}: 檔案路徑或目錄路徑

## 🔧 增強執行步驟

### 第一階段: 掃描分析 🔍

1. **參數解析與驗證**
   - [ ] 確認輸入路徑（檔案或目錄）
   - [ ] 如果是目錄，遞迴搜尋所有 `.vue` 和 `.ts` 檔案
   - [ ] 驗證路徑存在並可存取

2. **中文內容萃取**
   - [ ] 掃描指定路徑的 `.vue` 和 `.ts` 檔案
   - [ ] 排除已經使用 `$t()` 或 `t()` 的內容
   - [ ] 排除註解中的中文
   - [ ] 提取純中文字串和包含中文的混合內容

3. **現有 key 字典載入**
   - [ ] 讀取完整的 `i18n/zh-TW.json`
   - [ ] 建立 key-value 反向索引
   - [ ] 準備智能匹配算法

### 第二階段: 智能計劃 🧠

4. **現有 key 智能匹配**
   - [ ] **精確匹配**：完全相同的文字內容
   - [ ] **語義匹配**：相似含義文字 (確認/確定、儲存/保存)
   - [ ] **Common 優先**：優先匹配 `common.*` 命名空間

5. **內容分類分析**
   - [ ] **🔄 智能復用**：可直接使用現有 key 的內容
   - [ ] **➕ 建議新增**：需要創建新 key 的內容
   - [ ] **⚠️ 需要決策**：有多個選項或需要確認的內容

6. **新 key 命名建議**
   - [ ] 基於檔案路徑生成 `pages.{module}.{feature}.*` 格式
   - [ ] 遵循 camelCase 命名規範
   - [ ] 考慮語義分組和扁平化原則

### 第三階段: 計劃報告 📊

7. **結構化展示計劃**

   ```
   📊 i18n 萃取計劃報告 - {TARGET_PATH}
   ============================================

   🔢 掃描結果: X 個檔案，Y 條中文內容

   ┌─ 🔄 智能復用 (推薦) ───────────────
   │ "文字" → 使用 existing.key.path
   └─ 小計: N 條 ✨節省維護成本

   ┌─ ➕ 建議新增 ─────────────────────
   │ suggested.new.key: "文字內容"
   └─ 小計: M 條

   ┌─ ⚠️ 需要您決策 ─────────────────
   │ "文字"
   │   選項 A: option.a.path
   │   選項 B: option.b.path
   └─ 小計: K 條

   📈 預期效果:
   - [ ] 複用現有 key: +N (提升一致性)
   - [ ] 新增 zh-TW key: +M
   - [ ] 影響檔案: X 個
   - [ ] 維護效率提升: ~Y%
   ```

### 第四階段: 批量決策 ✅

8. **等待用戶確認**
   - [ ] 展示完整計劃報告
   - [ ] 等待用戶 review 和確認
   - [ ] 處理決策項目的選擇
9. **計劃調整**
   - [ ] 根據用戶回饋調整 key 命名
   - [ ] 確認最終執行方案
   - [ ] 記錄所有決策結果

### 第五階段: 執行變更 🚀

10. **自動備份**
    - [ ] 備份將要修改的所有檔案
    - [ ] 備份現有 `i18n/zh-TW.json`

11. **批量檔案更新**
    - [ ] 將中文內容替換為 i18n 函數調用
    - [ ] Vue 檔案使用 `$t()` 或 `t()`
    - [ ] TypeScript 檔案引入並使用 `useI18n`
    - [ ] 保持原始檔案格式和縮排

12. **語系檔更新**
    - [ ] 讀取現有的 `i18n/zh-TW.json`
    - [ ] 按照結構新增萃取的內容
    - [ ] 保持 key 排序和格式一致性

13. **生成完成報告**
    - [ ] 顯示實際處理的檔案數量和萃取的文字數量
    - [ ] 列出新增的 i18n key 清單
    - [ ] 統計復用 key 節省的維護成本
    - [ ] 提供後續操作建議

## 🎯 KISS 原則實踐

### 智能復用策略

1. **Common 優先**：最高優先級檢查 `common` 命名空間
2. **語義匹配**：積極匹配相似含義的文字
3. **減少重複**：避免在不同模組中創建相似的 key
4. **統一體驗**：使用 common 內容確保用戶體驗一致

### 🎯 高效匹配類別 (基於 validation-mapping.md 權威表)

> **權威參考**：所有匹配邏輯以 `.claude/rules/validation-mapping.md` 為準  
> **實測成果**：防火牆模組達成 47% 復用率，驗證了以下匹配策略的有效性

**一級優先 (高頻匹配)**：

- [ ] **驗證類**: `"必填"` • `"數值必填"` • `"必須為數字"` • `"格式錯誤"` • `"驗證失敗"`
- [ ] **操作類**: `"儲存"` • `"取消"` • `"新增"` • `"編輯"` • `"刪除"` • `"確定"`
- [ ] **結果類**: `"XX成功"` • `"XX失敗"` • `"無資料"` • `"全部"`

**二級優先 (特殊匹配)**：

- [ ] **錯誤碼類**: `"資源不存在"` • `"設備已存在"` • `"請求無效"` • `"發生未知錯誤"`
- [ ] **模板類**: `"您確定要刪除{type}[{name}]？"` (confirmDeleteTemplate)

**三級優先 (語義匹配)**：

- [ ] **相似語義**: "確認" ⇔ "確定"、"保存" ⇔ "儲存"、"建立" ⇔ "新增"
- [ ] **業務特定**: 包含具體業務名詞的文字優先考慮創建新 key

### 執行約束

- [ ] **🚨重要**: 永遠不要建議對 common 內容進行異動
- [ ] **只復用**: 對於 common key 僅進行復用，確保系統穩定
- [ ] **結構保護**: 保持現有 i18n 檔案的結構和順序

## ⚠️ 重要注意事項

### 處理原則

1. **計劃驅動**: 必須先完成計劃階段，獲得用戶確認後才執行
2. **批量決策**: 一次性展示所有待決策項目，提升效率
3. **Common 保護**: 絕對不修改 common 命名空間下的任何內容
4. **積極匹配**: 包含語義相似的智能匹配，最大化復用效果

### 品質保證

1. **自動備份**: 執行前自動備份所有相關檔案
2. **結構驗證**: 確保 zh-TW.json 結構和格式一致性
3. **語法檢查**: 驗證更新後的檔案語法正確性

## 📂 權威參考架構

**權威來源** (必須依賴)：

- [ ] `.claude/rules/validation-mapping.md` - **Common 映射權威參考表**（智能匹配的唯一來源）

**輔助規範**：

- [ ] `.claude/rules/i18n-guidelines.md` - i18n 命名與結構規範
- [ ] `codegen:ui` - 源頭優化工具（引用 validation-mapping.md）

> **重要**：所有智能匹配邏輯以 `validation-mapping.md` 為最終標準

## 📚 相關指令

- [ ] `/i18n:en` - 將 zh-TW.json 智能翻譯為 en-US.json
- [ ] 後續可執行 i18n 同步指令確保語系檔一致性

## 🧪 測試驗證

### 執行測試

```bash
# 測試單一檔案
/i18n:extract pages/sys/firewall/index.vue

# 測試目錄
/i18n:extract pages/sys/firewall

# 測試 TypeScript 檔案
/i18n:extract types/firewall.ts
```

### 驗證方式

1. **計劃準確性**: 檢查智能匹配結果是否合理
2. **復用效率**: 確認現有 key 復用比例 (目標 >30%)
3. **命名一致性**: 驗證新 key 命名符合規範
4. **檔案完整性**: 確認所有檔案正確更新
5. **語系同步**: 驗證 zh-TW.json 結構完整


### 🏆 效能基準與實測數據 (防火牆模組成功案例)

**實際成果** (基於 pages/sys/firewall 實測)：

- [ ] **復用率**: **47%** (超越最初 35-45% 目標)
- [ ] **處理檔案**: 4 個 Vue 檔案 + 1 個 i18n 檔案
- [ ] **創建新 key**: 22 個原創 key + 22 個 common key 復用
- [ ] **維護成本節省**: ~40% (標準化訊息統一)

**系統效益**：

- [ ] **系統一致性**: 大幅提升（common key 統一体驗）
- [ ] **翻譯效率**: 提升 40%（common key 已有英文翻譯）
- [ ] **後續維護**: 降低 35%（減少重複 key 維護）

**新目標設定** (基於成功經驗)：

- [ ] **標準復用率**: 45-50%
- [ ] **優秀復用率**: 50%+ (強化 common 映射)

## 版本歷史
- [ ] v1.0.0 (2025/10/20) 初始版本
